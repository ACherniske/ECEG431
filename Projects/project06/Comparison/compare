#!/bin/bash

# Function to display usage information
usage() {
    echo "Usage: $0 <file1> <file2>"
    echo "Compare two files line by line to check if they are identical"
    exit 1
}

# Check if exactly 2 arguments are provided
if [ $# -ne 2 ]; then
    echo "Error: Please provide exactly two file arguments"
    usage
fi

file1="$1"
file2="$2"

# Check if both files exist
if [ ! -f "$file1" ]; then
    echo "Error: File '$file1' does not exist"
    exit 1
fi

if [ ! -f "$file2" ]; then
    echo "Error: File '$file2' does not exist"
    exit 1
fi

# Check if both files are readable
if [ ! -r "$file1" ]; then
    echo "Error: File '$file1' is not readable"
    exit 1
fi

if [ ! -r "$file2" ]; then
    echo "Error: File '$file2' is not readable"
    exit 1
fi

echo "Comparing files:"
echo "  File 1: $file1"
echo "  File 2: $file2"
echo

# Method 1: Using diff command (simple and efficient)
if diff -q "$file1" "$file2" > /dev/null 2>&1; then
    echo "✓ Files are identical"
    exit 0
else
    echo "✗ Files are different"
    echo
    echo "Detailed comparison:"
    
    # Show the differences
    diff "$file1" "$file2"
    
    echo
    echo "Line-by-line analysis:"
    
    # Method 2: Manual line-by-line comparison for detailed output
    line_num=1
    differences_found=0
    
    # Read both files line by line
    while IFS= read -r line1 <&3 && IFS= read -r line2 <&4; do
        if [ "$line1" != "$line2" ]; then
            echo "  Line $line_num differs:"
            echo "    File 1: '$line1'"
            echo "    File 2: '$line2'"
            ((differences_found++))
        fi
        ((line_num++))
    done 3< "$file1" 4< "$file2"
    
    # Check if one file has more lines than the other
    while IFS= read -r line1 <&3; do
        echo "  Line $line_num: File 1 has extra line: '$line1'"
        ((differences_found++))
        ((line_num++))
    done 3< "$file1"
    
    while IFS= read -r line2 <&4; do
        echo "  Line $line_num: File 2 has extra line: '$line2'"
        ((differences_found++))
        ((line_num++))
    done 4< "$file2"
    
    if [ $differences_found -eq 0 ]; then
        echo "  No line differences found (files may differ in whitespace)"
    else
        echo "  Total differences: $differences_found"
    fi
    
    exit 1
fi
